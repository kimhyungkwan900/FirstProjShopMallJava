import{a as p,j as e,r as o,R as k,A as w}from"./index-DL8XAv-9.js";import{P as S}from"./Pagination-RndgT7BH.js";const I=async t=>(await p.get("/api/admin/orders",{params:t})).data,D=async t=>(await p.patch("/api/admin/orders/status",t,{withCredentials:!0,headers:{"Content-Type":"application/json"}})).data,O=({orderManage:t})=>e.jsxs("ul",{className:"p-10 ",children:[e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문ID:"})," ",t.order.id]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문자ID:"}),": ",t.order.member_id]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"배송지:"})," ",t.order.delivery_address]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"배송 요청사항:"})," ",t.order.delivery_request]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문일자:"})," ",new Date(t.order.order_date).toLocaleDateString()]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"결제방식:"})," ",t.order.payment_method]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문금액:"})," ",t.order.total_amount]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문상태:"})," ",t.orderStatus]})]}),P=({courier:t,setCourier:a,trackingNumber:c,setTrackingNumber:i})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"택배사"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded p-2",value:t,onChange:d=>a(d.target.value),children:[e.jsx("option",{value:"",children:"택배사 선택"}),e.jsx("option",{value:"04",children:"CJ대한통운"}),e.jsx("option",{value:"08",children:"롯데택배"}),e.jsx("option",{value:"06",children:"로젠택배"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"운송장 번호"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded p-2",value:c,onChange:d=>i(d.target.value),placeholder:"10~13자리 숫자 입력",maxLength:13})]})]}),_="http://localhost:8080/api",T=async t=>(await p.post(`${_}/order/trackingInput`,t)).data,A=({orderId:t,onClose:a})=>{const[c,i]=o.useState(""),[d,u]=o.useState(""),h=async()=>{if(!c){alert("택배사를 선택해주세요.");return}if(!/^\d{10,13}$/.test(d)){alert("운송장 번호는 10~13자리 숫자여야 합니다.");return}try{await T({orderId:t,courierCode:c,trackingNumber:d}),alert("운송장 등록이 완료되었습니다."),a()}catch(n){console.error("운송장 등록 실패",n),alert("운송장 등록 중 오류가 발생했습니다.")}};return e.jsx("div",{onClick:a,className:"fixed inset-0 bg-black/40 backdrop-blur-sm bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:n=>n.stopPropagation(),className:"bg-white rounded-lg p-6 w-full max-w-md shadow-lg",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["운송장 등록 (주문ID: ",t,")"]}),e.jsx(P,{courier:c,setCourier:i,trackingNumber:d,setTrackingNumber:u}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded",children:"취소"}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"등록"})]})]})})},L=({orderId:t})=>{const[a,c]=o.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{onClick:()=>c(!0),className:"bg-blue-400 text-white px-2 rounded hover:bg-blue-500 cursor-pointer",children:"운송장 등록"}),a&&e.jsx(A,{orderId:t,onClose:()=>c(!1)})]})},F=({searchFilters:t,currentPage:a,onPageChange:c})=>{const[i,d]=o.useState([]),[u,h]=o.useState(1),[n,l]=o.useState([]),[y,j]=o.useState(!1),[b,g]=o.useState(null),x=o.useCallback(async()=>{const s={...t,page:a};try{const r=await I(s);console.log("주문 리스트:"),console.log(r.orders.content),d(r.orders.content),h(r.totalPage),l([])}catch(r){console.error("주문 목록 불러오기 실패:",r),d([]),h(1)}},[t,a]);o.useEffect(()=>{x()},[x]);const f=s=>{l(r=>r.includes(s)?r.filter(C=>C!==s):[...r,s]),console.log(n)},m=async s=>{if(n.length!==0)try{const r=await D({ids:n,newStatus:s});console.log("patch결과: "+r)}catch(r){console.log("상태수정 실패: ",r)}finally{await x()}},v=s=>{console.log(s),g(s),j(!0)},N=()=>{j(!1),g(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col ml-10 mr-10 mt-10 relative",children:[e.jsx("button",{className:"absolute w-20 top-0 left-0 bg-gray-400 text-white rounded",onClick:()=>m("확인"),disabled:n.length===0,children:"확인"}),e.jsx("button",{className:"absolute w-20 top-0 left-24 bg-gray-400 text-white rounded",onClick:()=>m("배송중"),disabled:n.length===0,children:"배송중"}),e.jsx("button",{className:"absolute w-20 top-0 left-48 bg-gray-400 text-white rounded",onClick:()=>m("배송완료"),disabled:n.length===0,children:"배송완료"}),e.jsxs("table",{id:"list",className:"border border-gray-400 mt-8",children:[e.jsxs("tr",{className:"bg-gray-400",children:[e.jsx("th",{}),e.jsx("th",{children:"주문ID"}),e.jsx("th",{children:"고객ID"}),e.jsx("th",{children:"주문상태"}),e.jsx("th",{children:"주문날짜"}),e.jsx("th",{children:"주문가격"}),e.jsx("th",{children:"결제방식"}),e.jsx("th",{children:"운송장 등록"})]}),i.length===0?e.jsx("tr",{}):i.map(s=>e.jsxs("tr",{className:"text-center hover:bg-gray-100 cursor-pointer",onClick:()=>v(s),children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:n.includes(s.orderManageId),onClick:r=>r.stopPropagation(),onChange:()=>f(s.orderManageId)})}),e.jsx("td",{children:s.order.id}),e.jsx("td",{children:s.order.member_id}),e.jsx("td",{children:s.orderStatus}),e.jsx("td",{children:new Date(s.order.order_date).toLocaleDateString()}),e.jsx("td",{children:s.order.total_amount}),e.jsx("td",{children:s.order.payment_method}),e.jsx("td",{onClick:r=>r.stopPropagation(),children:s.orderStatus==="배송중"?e.jsx(L,{orderId:s.order.id}):null})]},s.orderManageId))]}),e.jsx(S,{currentPage:a,totalPages:u,onPageChange:c})]}),e.jsxs(k,{isOpen:y,onRequestClose:N,overlayClassName:"fixed inset-0 bg-black bg-transparent flex justify-center items-center",className:"relative bg-white w-9/20 border rounded-lg overflow-auto mx-auto",style:{content:{top:"1%",left:"1%",right:"1%"}},children:[e.jsx("button",{className:"absolute top-1 right-1 text-5xl text-gray-600 hover:text-gray-900",onClick:N,children:"×"}),b&&e.jsx(O,{orderManage:b})]})]})},M=()=>{const[t,a]=o.useState({searchType:"",searchContent:"",orderStatus:"",startDate:"",endDate:""}),[c,i]=o.useState(0),[d,u]=o.useState(t),h=()=>{u(t),i(0)},n=l=>{i(l)};return e.jsxs(w,{children:[e.jsxs("div",{className:"space-y-2 ml-10 mt-10",children:["검색유형:",e.jsxs("select",{value:t.searchType,onChange:l=>a({...t,searchType:l.target.value}),className:"border ml-2 p-1",children:[e.jsx("option",{value:"주문 ID",children:"주문 ID"}),e.jsx("option",{value:"고객 ID",children:"고객 ID"})]}),e.jsx("input",{type:"text",value:t.searchContent,onChange:l=>a({...t,searchContent:l.target.value}),className:"border ml-2 p-1"}),"주문 상태:",e.jsxs("select",{value:t.orderStatus,onChange:l=>a({...t,orderStatus:l.target.value}),className:"border ml-2 p-1",children:[e.jsx("option",{value:"접수",children:"접수"}),e.jsx("option",{value:"확인",children:"확인"}),e.jsx("option",{value:"배송중",children:"배송중"}),e.jsx("option",{value:"배송완료",children:"배송완료"})]}),"주문일자:",e.jsx("input",{type:"date",value:t.startDate,onChange:l=>a({...t,startDate:l.target.value}),className:"border ml-2 p-1"}),e.jsx("input",{type:"date",value:t.endDate,onChange:l=>a({...t,endDate:l.target.value}),className:"border ml-2 p-1"})]}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-1 ml-10 rounded",onClick:h,children:"검색"}),e.jsx(F,{searchFilters:d,currentPage:c,onPageChange:n})]})};export{M as default};
