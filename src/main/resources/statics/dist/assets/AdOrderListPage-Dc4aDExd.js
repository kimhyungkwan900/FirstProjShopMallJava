import{a as p,j as e,w as S,r as o,u as y,R as I,A as D}from"./index-BriUKL8v.js";import{P as O}from"./Pagination-D5Npcb15.js";const T=async t=>(await p.get("/api/admin/orders",{params:t})).data,P=async(t,s)=>(await p.patch("/api/admin/orders/status",t,{withCredentials:!0,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s}})).data,_=({orderManage:t})=>e.jsxs("ul",{className:"p-10 ",children:[e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문ID:"})," ",t.order.id]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문자ID:"}),": ",t.order.member_id]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"배송지:"})," ",t.order.delivery_address]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"배송 요청사항:"})," ",t.order.delivery_request]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문일자:"})," ",new Date(t.order.order_date).toLocaleDateString()]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"결제방식:"})," ",t.order.payment_method]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문금액:"})," ",t.order.total_amount]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("p",{className:"font-bold",children:"주문상태:"})," ",t.orderStatus]})]}),A=({courier:t,setCourier:s,trackingNumber:l,setTrackingNumber:c})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"택배사"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded p-2",value:t,onChange:d=>s(d.target.value),children:[e.jsx("option",{value:"",children:"택배사 선택"}),e.jsx("option",{value:"04",children:"CJ대한통운"}),e.jsx("option",{value:"08",children:"롯데택배"}),e.jsx("option",{value:"06",children:"로젠택배"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"운송장 번호"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded p-2",value:l,onChange:d=>c(d.target.value),placeholder:"10~13자리 숫자 입력",maxLength:13})]})]}),L="http://localhost:8080/api",E=async(t,s)=>(await p.post(`${L}/order/trackingInput`,t,S(s))).data,F=({orderId:t,onClose:s})=>{const[l,c]=o.useState(""),[d,i]=o.useState(""),h=y(),u=async()=>{if(!l){alert("택배사를 선택해주세요.");return}if(!/^\d{10,13}$/.test(d)){alert("운송장 번호는 10~13자리 숫자여야 합니다.");return}try{await E({orderId:t,courierCode:l,trackingNumber:d,csrfToken:h}),alert("운송장 등록이 완료되었습니다."),s()}catch(a){console.error("운송장 등록 실패",a),alert("운송장 등록 중 오류가 발생했습니다.")}};return e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black/40 backdrop-blur-sm bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{onClick:a=>a.stopPropagation(),className:"bg-white rounded-lg p-6 w-full max-w-md shadow-lg",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["운송장 등록 (주문ID: ",t,")"]}),e.jsx(A,{courier:l,setCourier:c,trackingNumber:d,setTrackingNumber:i}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded",children:"취소"}),e.jsx("button",{onClick:u,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"등록"})]})]})})},R=({orderId:t})=>{const[s,l]=o.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{onClick:()=>l(!0),className:"bg-blue-400 text-white px-2 rounded hover:bg-blue-500 cursor-pointer",children:"운송장 등록"}),s&&e.jsx(F,{orderId:t,onClose:()=>l(!1)})]})},M=({searchFilters:t,currentPage:s,onPageChange:l})=>{const c=y(),[d,i]=o.useState([]),[h,u]=o.useState(1),[a,j]=o.useState([]),[v,b]=o.useState(!1),[g,N]=o.useState(null),x=o.useCallback(async()=>{const r={...t,page:s};try{const n=await T(r);i(n.orders.content),u(n.totalPage),j([])}catch(n){console.error("주문 목록 불러오기 실패:",n),i([]),u(1)}},[t,s]);o.useEffect(()=>{x()},[x]);const C=r=>{j(n=>n.includes(r)?n.filter(w=>w!==r):[...n,r])},m=async r=>{if(a.length!==0)try{await P({ids:a,newStatus:r},c)}catch(n){console.log("상태수정 실패: ",n)}finally{await x()}},k=r=>{N(r),b(!0)},f=()=>{b(!1),N(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col ml-10 mr-10 mt-10 relative",children:[e.jsx("button",{className:"absolute w-20 top-0 left-0 bg-gray-400 text-white rounded",onClick:()=>m("확인"),disabled:a.length===0,children:"확인"}),e.jsx("button",{className:"absolute w-20 top-0 left-24 bg-gray-400 text-white rounded",onClick:()=>m("배송중"),disabled:a.length===0,children:"배송중"}),e.jsx("button",{className:"absolute w-20 top-0 left-48 bg-gray-400 text-white rounded",onClick:()=>m("배송완료"),disabled:a.length===0,children:"배송완료"}),e.jsxs("table",{id:"list",className:"border border-gray-400 mt-8",children:[e.jsxs("tr",{className:"bg-gray-400",children:[e.jsx("th",{}),e.jsx("th",{children:"주문ID"}),e.jsx("th",{children:"고객ID"}),e.jsx("th",{children:"주문상태"}),e.jsx("th",{children:"주문날짜"}),e.jsx("th",{children:"주문가격"}),e.jsx("th",{children:"결제방식"}),e.jsx("th",{children:"운송장 등록"})]}),d.length===0?e.jsx("tr",{}):d.map(r=>e.jsxs("tr",{className:"text-center hover:bg-gray-100 cursor-pointer",onClick:()=>k(r),children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:a.includes(r.orderManageId),onClick:n=>n.stopPropagation(),onChange:()=>C(r.orderManageId)})}),e.jsx("td",{children:r.order.id}),e.jsx("td",{children:r.order.member_id}),e.jsx("td",{children:r.orderStatus}),e.jsx("td",{children:new Date(r.order.order_date).toLocaleDateString()}),e.jsx("td",{children:r.order.total_amount}),e.jsx("td",{children:r.order.payment_method}),e.jsx("td",{onClick:n=>n.stopPropagation(),children:r.orderStatus==="배송중"?e.jsx(R,{orderId:r.order.id}):null})]},r.orderManageId))]}),e.jsx(O,{currentPage:s,totalPages:h,onPageChange:l})]}),e.jsxs(I,{isOpen:v,onRequestClose:f,overlayClassName:"fixed inset-0 bg-black bg-transparent flex justify-center items-center",className:"relative bg-white w-9/20 border rounded-lg overflow-auto mx-auto",style:{content:{top:"1%",left:"1%",right:"1%"}},children:[e.jsx("button",{className:"absolute top-1 right-1 text-5xl text-gray-600 hover:text-gray-900",onClick:f,children:"×"}),g&&e.jsx(_,{orderManage:g})]})]})},U=()=>{const[t,s]=o.useState({searchType:"",searchContent:"",orderStatus:"",startDate:"",endDate:""}),[l,c]=o.useState(0),[d,i]=o.useState(t),h=()=>{i(t),c(0)},u=a=>{c(a)};return e.jsxs(D,{children:[e.jsxs("div",{className:"space-y-2 ml-10 mt-10",children:[e.jsx("span",{className:"font-bold",children:"검색유형:"}),e.jsxs("select",{value:t.searchType,onChange:a=>s({...t,searchType:a.target.value}),className:"border ml-2 p-1 rounded",children:[e.jsx("option",{value:null,children:"-"}),e.jsx("option",{value:"주문 ID",children:"주문 ID"}),e.jsx("option",{value:"고객 ID",children:"고객 ID"})]}),e.jsx("input",{type:"text",value:t.searchContent,onChange:a=>s({...t,searchContent:a.target.value}),className:"border ml-2 p-1 rounded"}),e.jsx("span",{className:"font-bold ml-5",children:"주문 상태:"}),e.jsxs("select",{value:t.orderStatus,onChange:a=>s({...t,orderStatus:a.target.value}),className:"border ml-2 p-1 rounded",children:[e.jsx("option",{value:null,children:"-"}),e.jsx("option",{value:"접수",children:"접수"}),e.jsx("option",{value:"확인",children:"확인"}),e.jsx("option",{value:"배송중",children:"배송중"}),e.jsx("option",{value:"배송완료",children:"배송완료"})]}),e.jsx("span",{className:"font-bold ml-5",children:"주문일자:"}),e.jsx("input",{type:"date",value:t.startDate,onChange:a=>s({...t,startDate:a.target.value}),className:"border ml-2 p-1 rounded"}),e.jsx("input",{type:"date",value:t.endDate,onChange:a=>s({...t,endDate:a.target.value}),className:"border ml-2 p-1 rounded"})]}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-1 ml-10 rounded",onClick:h,children:"검색"}),e.jsx(M,{searchFilters:d,currentPage:l,onPageChange:u})]})};export{U as default};
